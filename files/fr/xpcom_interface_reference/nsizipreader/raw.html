<p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/modules/libjar/nsIZipReader.idl" rel="custom">modules/libjar/nsIZipReader.idl</a></code><span style="text-align: right; float: right;"><a href="/fr/docs/Interfaces/À_propos_des_interfaces_scriptables" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

Cette interface fournit des méthodes pour la lecturedes fichiers compressés (zip) .
</span>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 10.0 (Firefox 10.0 / Thunderbird 10.0 / SeaMonkey 2.7)</span></div>
</div><p></p>

<p>Implemented by: <code>@mozilla.org/libjar/zip-reader;1</code>. To create an instance, use:</p>

<pre class="brush: js">var zipReader = Components.classes["@mozilla.org/libjar/zip-reader;1"]
                .createInstance(Components.interfaces.nsIZipReader);
</pre>

<h2 id="A_propos_des_jeux_de_caractères_et_pages_de_codes">A propos des jeux de caractères et pages de codes</h2>

<div class="note"><strong>Note: </strong> <code>nsIZipReader</code> a un problème de <a href="https://fr.wikipedia.org/wiki/Page_de_code">page de code</a>; dans la spécification ZIP, les noms de fichiers sont censés utiliser 7-bit ASCII; Cependant, la plupart des systèmes de fichiers modernes utilisent 8 bit de pages de codes, comme UTF-8. Cela peut désorganiser les caractères dans l'API <code>nsIZipReader</code>.</div>

<p>À partir de Gecko 10,0 (Firefox 10.0 / Thunderbird 10.0 / SeaMonkey 2.7), l'API <code>nsIZipReader</code> prend en charge de façon limité, 8 bits de page de code. Toutes les fonctions passent maintenant les noms de fichiers (dedans et dehors) en <code>AUTF8String</code>. Ainsi, vous pouvez désormais lire et extraire ce que vous avez écrit avec l'<code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipWriter" title="">nsIZipWriter</a></code>. Si vous comparez les noms de fichiers de <code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#findEntries()">findEntries()</a></code> et de l'interface utilisateur, la mise en correspondance de caractères se base sur UTF-8 archives ZIP.</p>

<h2 id="Method_overview" name="Method_overview">Aperçu des Méthode</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td><code>void <a href="#close()">close</a>();</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#extract()">extract</a>(in AUTF8String zipEntry, in nsIFile outFile);</code> <br>
    <code>void <a href="#extract()">extract</a>(in string zipEntry, in nsIFile outFile);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIUTF8StringEnumerator <a href="#findEntries()">findEntries</a>(in AUTF8String aPattern);</code> <br>
    <code>nsIUTF8StringEnumerator <a href="#findEntries()">findEntries</a>(in string aPattern);</code>  <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIPrincipal <a href="#getCertificatePrincipal()">getCertificatePrincipal</a>(in AUTF8String aEntryName);</code> <br>
    <code>nsIPrincipal <a href="#getCertificatePrincipal()">getCertificatePrincipal</a>(in string aEntryName);</code>  <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIZipEntry <a href="#getEntry()">getEntry</a>(in AUTF8String zipEntry); </code><br>
    <code>nsIZipEntry <a href="#getEntry()">getEntry</a>(in string zipEntry);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIInputStream <a href="#getInputStream()">getInputStream</a>(in AUTF8String zipEntry); </code><br>
    <code>nsIInputStream <a href="#getInputStream()">getInputStream</a>(in string zipEntry);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>nsIInputStream <a href="#getInputStreamWithSpec()">getInputStreamWithSpec</a>(in AUTF8String aJarSpec, in AUTF8String zipEntry);</code> <br>
    <code>nsIInputStream <a href="#getInputStreamWithSpec()">getInputStreamWithSpec</a>(in AUTF8String aJarSpec, in string zipEntry);</code>  <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>boolean <a href="#hasEntry()">hasEntry</a>(in AUTF8String zipEntry);</code> </td>
  </tr>
  <tr>
   <td><code>void <a href="#init()">init</a>(in nsIFile zipFile);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolète depuis Gecko 1.9</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#open()">open</a>(in nsIFile zipFile);</code></td>
  </tr>
  <tr>
   <td><code>void <a href="#openInner()">openInner</a>(in nsIZipReader zipReader, in AUTF8String zipEntry);</code> <br>
    <code>void <a href="#openInner()">openInner</a>(in nsIZipReader zipReader, in string zipEntry);</code>  <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
  <tr>
   <td><code>void <a href="#test()">test</a>(in AUTF8String aEntryName);</code> <br>
    <code>void <a href="#test()">test</a>(in string aEntryName);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 10 / Thunderbird 10 / SeaMonkey 2.7)">Obsolète depuis Gecko 10</span></td>
  </tr>
 </tbody>
</table>

<h2 id="Attributes" name="Attributes">Attributs</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">Attribut</td>
   <td class="header">Type</td>
   <td class="header">Description</td>
  </tr>
  <tr>
   <td><code>file</code></td>
   <td><code><code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFile" title="">nsIFile</a></code></code></td>
   <td>Le <code>file</code> qui représente le zip avec lequel ce lecteur zip a été initialisé. <strong> Lecture seule. </strong></td>
  </tr>
  <tr>
   <td><code>manifestEntriesCount</code></td>
   <td><code><a href="/en/PRUint32" title="en/PRUint32">PRUint32</a></code></td>
   <td>Le nombre d'entrées dans le manifeste. <strong> Lecture seule. </strong> </td>
  </tr>
 </tbody>
</table>

<h2 id="Methods" name="Methods">Méthodes</h2>

<h3 id="close()" name="close()">close()</h3>

<p>Ferme un lecteur zip. Les tentatives ultérieures d'<code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#extract()">extract()</a></code> des fichiers ou lire à partir de son flux d'entrée se traduira par une erreur. Les tentatives ultérieures pour accéder à un nsIZipEntry obtenu à partir de ce lecteur zip va provoquer un comportement non spécifié.</p>

<pre class="eval">void close();
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<p>None.</p>

<div class="note">
<p>Exemple pour démontrer cette fonction: <a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents" title="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents"> Lister le contenu de XPI et Lire le Contenu du fichier </a></p>
</div>

<h3 id="extract()" name="extract()">extract()</h3>

<p>Extrait une entrée zip dans un <code>file</code> local spécifié par <code>outFile</code>. L'entrée doit être stocké dans le zip, dans un format non compressé ou <a href="https://fr.wikipedia.org/wiki/Deflate">DEFLATE-compressed</a> pour que l'extraction soit couronnée de succès. Si l'entrée est un répertoire, le répertoire sera extrait de façon non-récursive.</p>

<pre class="eval">void extract(
  in AUTF8String zipEntry,
  in nsIFile outFile
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>L'entrée de zip à extraire.</dd>
 <dt><code>outFile</code></dt>
 <dd>La destination de fichier local utilisé pour extraire l'entrée de zip.</dd>
</dl>

<p></p><h3 id="findEntries()">findEntries()</h3><p></p>

<p>Renvoie un énumérateur de chaîne contenant les noms d'entrées correspondantes.</p>

<pre class="eval">nsIUTF8StringEnumerator findEntries(
  in AUTF8String aPattern
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aPattern</code></dt>
 <dd>A regular expression used to find matching entries in the zip <code>file</code>. Set this parameter to null (javascript) or EmptyCString() (c++) to get all entries; otherwise, use the following syntax:
 <ul>
  <li>* ne correspond à rien.</li>
  <li>? correspond à un caractère.</li>
  <li>$ Correspond à la fin de la chaîne.</li>
  <li>[abc] matches one occurrence of a, b, or c. The only character that must be escaped inside the brackets is ]. ^ and - must never appear in the first and second positions within the brackets, respectively. (In the former case, the behavior specified for '[^az]' will happen.)</li>
  <li>[a-z] matches any character between a and z. The characters a and z must either both be letters or both be numbers, with the character represented by 'a' having a lower ASCII value than the character represented by 'z'.</li>
  <li>[^az] matches any character except a or z. If ] is to appear inside the brackets as a character to not match, it must be escaped.</li>
  <li>Pat~pat2 returns matches to the pattern 'pat' which do not also match the pattern 'pat2'. This may be used to perform filtering upon the results of one pattern to remove all matches which also match another pattern. For example, because '*' matches any string and '*z*' matches any string containing a 'z', '*~*z*' will match all strings except those containing a 'z'. Note that a pattern may not use '~' multiple times, so a string such as '*~*z*~*y*' is not a valid pattern.</li>
  <li>(foo|bar) will match either the pattern foo or the pattern bar. Neither of the patterns foo or bar may use the 'pat~pat2' syntax described immediately above.</li>
  <li>\ will escape a special character. Escaping is required for all special characters unless otherwise specified.</li>
  <li>All other characters match case-sensitively.</li>
 </ul>

 <p> </p>

 <p>An aPattern not conforming to this syntax has undefined behavior.</p>
 </dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIUTF8StringEnumerator" title="">nsIUTF8StringEnumerator</a></code> containing the matching entry names.</p>

<h6 id="Exceptions_thrown" name="Exceptions_thrown">Exceptions thrown</h6>

<dl>
 <dt><code>NS_ERROR_ILLEGAL_VALUE</code></dt>
 <dd>On many but not all invalid <code>aPattern</code> values.</dd>
</dl>

<p></p><h3 id="getCertificatePrincipal()">getCertificatePrincipal()</h3><p></p>

<p>Returns an object describing the entity which signed an entry. parseManifest must be called first. If <code>aEntryName</code> is an entry in the jar, <code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#getInputStream()">getInputStream()</a></code> must be called after parseManifest. If <code>aEntryName</code> is an external <code>file</code> which has meta-information stored in the jar, verifyExternalFile (not yet implemented) must be called before <code>getPrincipal</code>.</p>

<pre class="eval">nsIPrincipal getCertificatePrincipal(
  in string aEntryName
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aEntryName</code></dt>
 <dd>Missing Description</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>An <code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPrincipal" title="">nsIPrincipal</a></code>.</p>

<div class="note">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<h3 id="getEntry()" name="getEntry()">getEntry()</h3>

<p>Returns a <code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipEntry" title="">nsIZipEntry</a></code> describing a specified zip entry.</p>

<pre class="eval">nsIZipEntry getEntry(
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code>nsIZipEntry</code> for the given zip entry.</p>

<div class="note">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<h3 id="getInputStream()" name="getInputStream()">getInputStream()</h3>

<p>Returns an input stream containing the contents of the specified zip entry.</p>

<pre class="eval">nsIInputStream getInputStream(
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The name of the entry to <code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#open()">open()</a></code> the stream from.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIInputStream" title="">nsIInputStream</a></code> containing the contents of the specified zip entry.</p>

<div class="note">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<p></p><h3 id="getInputStreamWithSpec()">getInputStreamWithSpec()</h3><p></p>

<p>Returns an input stream containing the contents of the specified zip entry. If the entry refers to a directory (ends with '/'), a directory stream is opened, otherwise the contents of the <code>file</code> entry is returned.</p>

<pre class="eval">nsIInputStream getInputStreamWithSpec(
  in AUTF8String aJarSpec,
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aJarSpec</code></dt>
 <dd>The Spec of the URI for the JAR (only used for directory streams).</dd>
 <dt><code>zipEntry</code></dt>
 <dd>The name of the entry to <code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#open()">open()</a></code> the stream from.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>The <code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIInputStream" title="">nsIInputStream</a></code> containing the contents of the specified zip entry.</p>

<p></p><h3 id="hasEntry()">hasEntry()</h3><p></p>

<p>Checks whether the zipfile contains an entry specified by <code>zipEntry</code>.</p>

<pre class="eval">boolean hasEntry(
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry.</dd>
</dl>

<h6 id="Return_value" name="Return_value">Return value</h6>

<p>Boolean value, <code>true</code> if the zip entry exists, <code>false</code> is it does not exist.</p>

<p></p><div class="headingWithIndicator">
        <h3 id="init()">init()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolète depuis Gecko 1.9 (Firefox 3)</span>
        </div><p></p>

<p>Initializes a zip reader after construction.</p>

<pre class="eval">void init(
  in nsIFile zipFile
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipFile</code></dt>
 <dd>Zip file to initialize.</dd>
</dl>

<h3 id="open()" name="open()">open()</h3>

<p>Opens a zip <code>file</code> for reading. It is allowed to <code>open</code> with another <code>file</code>, but it needs to be closed first with <code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#close()">close()</a></code>.</p>

<p></p><div class="blockIndicator note"><strong>Note :</strong> Prior to <span title="(Firefox 3)">Gecko 1.9</span> you first had to call <code><a href="https://developer.mozilla.org/fr/docs/XPCOM_Interface_Reference/nsIZipReader#init()">init()</a></code>"."</div><p></p>

<pre class="eval">void open(
  in nsIFile zipFile 
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>zipFile</code></dt>
 <dd>The zip file to open.</dd>
</dl>

<div class="note">
<p>Example demonstrating this function: <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipReader#List_contents_of_XPI_and_read_file_contents">List Contents of XPI and Read File Contents</a></p>
</div>

<p></p><h3 id="openInner()">openInner()</h3><p></p>

<p>Opens a zip file inside a zip file for reading.</p>

<pre class="eval">void openInner(
  in nsIZipReader zipReader, 
  in AUTF8String zipEntry
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt> </dt>
 <dt><code>zipReader</code></dt>
 <dd>The zipReader object.</dd>
 <dt><code>zipEntry</code></dt>
 <dd>The zip entry.</dd>
</dl>

<h3 id="test()" name="test()">test()</h3>

<p>Tests the integrity of the archive by performing a CRC check on each item expanded into memory. If an entry is specified the integrity of only that item is tested. If null (javascript) or EmptyCString() (c++) is passed in the integrity of all items in the archive are tested.</p>

<pre class="eval">void test(
  in AUTF8String aEntryName
);
</pre>

<h6 id="Parameters" name="Parameters">Parameters</h6>

<dl>
 <dt><code>aEntryName</code></dt>
 <dd>The single entity to check or <code>null</code> for checking all entries in the archive.</dd>
</dl>

<h2 id="See_also" name="See_also">Examples</h2>

<h3 id="List_contents_of_XPI_and_read_file_contents">List contents of XPI and read file contents</h3>

<p>This example uses <code><a href="#findEntries()">findEntries</a></code>, <code><a href="#getEntry()">getEntry</a>, </code><code><a href="#getInputStream()">getInputStream</a></code>, <code><a href="#open()">open</a></code>, and <code><a href="#close()">close</a></code>. It also uses <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIScriptableInputStream">nsIScriptableInputStream</a> to read the stream returned by <code>getInputStream</code>. XPI files are ZIP files, just Firefox needs the extension to be XPI. Change "<code>PortableTester@jetpack.xpi</code>" to the name of a XPI file in your extensions folder. Then you can copy and paste this code in scratchpad to run it.</p>

<pre class="brush: js">    var zr = Cc["@mozilla.org/libjar/zip-reader;1"].createInstance(Ci.nsIZipReader);
    Cu.import('resource://gre/modules/osfile.jsm');
    Cu.import('resource://gre/modules/FileUtils.jsm');
    
    var reusableStreamInstance = Cc['@mozilla.org/scriptableinputstream;1'].createInstance(Ci.nsIScriptableInputStream);
    
    var pathToXpiToRead = OS.Path.join(OS.Constants.Path.profileDir, 'extensions', 'PortableTester@jetpack.xpi');
    var nsiFileXpi = new FileUtils.File(pathToXpiToRead);
    
    //Services.ww.activeWindow.alert(pathToXpiToRead);
    
    try {
      zr.open(nsiFileXpi); //if file dne it throws here
      var entries = zr.findEntries('*'); //we use asterik because we want EVERYTHING listed out
      while (entries.hasMore()) {
        var entryPointer = entries.getNext(); //just a string of "zip path" (this means path to file in zip, and it uses forward slashes remember)
        var entry = zr.getEntry(entryPointer); // should return true on `entry instanceof Ci.nsIZipEntry`
        console.log('entryPointer', entryPointer);
        /* CONSOLE OUTPUT
         * "entryPointer" "bootstrap.js" Scratchpad/1:18
         */
        console.info('entry', entry);
        /* CONSOLE OUTPUT
         * "entry" XPCWrappedNative_NoHelper { QueryInterface: QueryInterface(), compression: Getter, size: Getter, realSize: Getter, CRC32: Getter, isDirectory: Getter, lastModifiedTime: Getter, isSynthetic: Getter, permissions: Getter, compression: 8 } Scratchpad/1:19
         */
        if (!entry.isDirectory) {
            var inputStream = zr.getInputStream(entryPointer);
            reusableStreamInstance.init(inputStream);
            var fileContents = reusableStreamInstance.read(entry.realSize);
            console.log('contenst of file=', fileContents);
        } else {
            console.log('is directory, no stream to read');
        }
      }
    } catch (ex) {
      console.warn('exception occured = ', ex);
      if (ex.name == 'NS_ERROR_FILE_NOT_FOUND') {
        Services.ww.activeWindow.alert('XPI at path does not exist!\n\nPath = ' + pathToXpiToRead);
      }
    } finally {
      zr.close();
      console.log('zr closed');
    }</pre>

<h2 id="See_also" name="See_also">See also</h2>

<ul>
 <li><code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipEntry" title="">nsIZipEntry</a></code></li>
 <li><code><a href="/fr/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIZipWriter" title="">nsIZipWriter</a></code></li>
</ul>

<p></p>