<div>{{LearnSidebar}}{{PreviousMenuNext("Learn/JavaScript/Client-side_web_APIs/Fetching_data", "Learn/JavaScript/Client-side_web_APIs/Drawing_graphics", "Learn/JavaScript/Client-side_web_APIs")}}</div>

<p class="summary">これまで説明してきた API はブラウザに組み込まれていましたが、すべての API がそうというわけではありません。Google Maps・Twitter・Facebook・PayPal などの大規模なサイトやサービスの多くは開発者がそれらのデータ (ブログに Twitter のストリームを表示するなど) やサービス (ユーザのログインに Facebook ログインを利用するなど) を利用できるように API を提供しています。この記事ではブラウザ API とサードパーティ API の違いを見て、後者の典型的な使い方について説明します。</p>

<table class="learn-box standard-table">
 <tbody>
  <tr>
   <th scope="row">前提知識:</th>
   <td>JavaScript の基礎 (<a href="/ja/docs/Learn/JavaScript/First_steps">JavaScript の第一歩</a>, <a href="/ja/docs/Learn/JavaScript/Building_blocks">JavaScript の構成要素</a>, <a href="/ja/docs/Learn/JavaScript/Objects">JavaScript オブジェクト入門</a> をご覧ください),<a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs">クライアントサイド API の基礎</a></td>
  </tr>
  <tr>
   <th scope="row">到達目標:</th>
   <td>サードパーティ API の仕組み、それらを利用して Web サイトを強化する方法を学習する</td>
  </tr>
 </tbody>
</table>

<h2 id="サードパーティAPIとは">サードパーティAPIとは?</h2>

<p>サードパーティ API は、サードパーティ (通常は Facebook、Twitter、Google などの企業) が提供する API で、JavaScript を介して機能にアクセスしてサイトで使用することができます。最もわかりやすい例の1つとして、マッピング API を使用してページにカスタムマップを表示することがあります。</p>

<p><a href="https://mdn.github.io/learning-area/javascript/apis/third-party-apis/mapquest/">Simple Mapquest API の例</a>を参考に、サードパーティ API とブラウザ API の違いを説明します。</p>

<div class="note">
<p><strong>注意</strong>: 一度に<a href="/ja/docs/Learn#Getting_our_code_examples">すべてのコード例を取得</a>したい場合があります。その場合は、各セクションで必要なサンプルファイルをレポジトリで検索するだけで済みます。</p>
</div>

<h3 id="それらはサードパーティのサーバにあります">それらはサードパーティのサーバにあります</h3>

<p>ブラウザ API はブラウザに組み込まれており、すぐに JavaScript からアクセスできます。たとえば、<a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Introduction#How_do_APIs_work">紹介記事で見た</a>Web Audio API は、ネイティブの {{domxref("AudioContext")}} オブジェクトを使ってアクセスします。例えば：</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="keyword token">const</span> audioCtx <span class="operator token">=</span> <span class="keyword token">new</span> <span class="class-name token">AudioContext</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
  <span class="operator token">...</span>
<span class="keyword token">const</span> audioElement <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">querySelector</span><span class="punctuation token">(</span><span class="string token">'audio'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
  <span class="operator token">...</span>
<span class="keyword token">const</span> audioSource <span class="operator token">=</span> audioCtx<span class="punctuation token">.</span><span class="function token">createMediaElementSource</span><span class="punctuation token">(</span>audioElement<span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="comment token">// etc.</span></code></pre>

<p>一方、サードパーティの API はサードパーティのサーバにあります。JavaScript からこれらにアクセスするには、まず API 機能に接続してページで利用できるようにする必要があります。 これは通常、Mapquest の例で見られるように、{{htmlelement("script")}} 要素を介してサーバ上で利用可能なJavaScriptライブラリへの最初のリンクを含めます。</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="operator token">&lt;</span>script src<span class="operator token">=</span><span class="string token">"https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"</span><span class="operator token">&gt;</span><span class="operator token">&lt;</span><span class="operator token">/</span>script<span class="operator token">&gt;</span>
<span class="operator token">&lt;</span>link type<span class="operator token">=</span><span class="string token">"text/css"</span> rel<span class="operator token">=</span><span class="string token">"stylesheet"</span> href<span class="operator token">=</span><span class="string token">"https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css"</span><span class="operator token">/</span><span class="operator token">&gt;</span></code></pre>

<p>そのライブラリで利用可能なオブジェクトを使い始めることができます。例えば：</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="keyword token">var</span> <span class="constant token">L</span><span class="punctuation token">;</span>

<span class="keyword token">var</span> map <span class="operator token">=</span> <span class="constant token">L</span><span class="punctuation token">.</span>mapquest<span class="punctuation token">.</span><span class="function token">map</span><span class="punctuation token">(</span><span class="string token">'map'</span><span class="punctuation token">,</span> <span class="punctuation token">{</span>
  center<span class="punctuation token">:</span> <span class="punctuation token">[</span><span class="number token">53.480759</span><span class="punctuation token">,</span> <span class="operator token">-</span><span class="number token">2.242631</span><span class="punctuation token">]</span><span class="punctuation token">,</span>
  layers<span class="punctuation token">:</span> <span class="constant token">L</span><span class="punctuation token">.</span>mapquest<span class="punctuation token">.</span><span class="function token">tileLayer</span><span class="punctuation token">(</span><span class="string token">'map'</span><span class="punctuation token">)</span><span class="punctuation token">,</span>
  zoom<span class="punctuation token">:</span> <span class="number token">12</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>ここでは、マップ情報を格納するための変数を作成し、次に <code>mapquest.map()</code> メソッドを使用して新しいマップを作成します。このメソッドは、必要な {{htmlelement("div")}} 要素のIDを受け取ります。('map') で地図を表示し、表示したい特定の地図の詳細を含む options オブジェクトを表示します。この場合は、地図の中心座標、表示する <code>map</code> 型の地図レイヤ (<code>mapquest.tileLayer()</code> メソッドを使用して作成)、およびデフォルトのズームレベルを指定します。</p>

<p>これが、Mapquest API が単純な地図を描くために必要なすべての情報です。接続しているサーバは、表示されている地域の正しい地図タイルを表示するなど、複雑なものをすべて処理します。</p>

<div class="note">
<p><strong>メモ</strong>: API の中には、機能へのアクセスをわずかに異なる方法で処理するものがあり、開発者はデータを取得するために特定の URL パターンに対して HTTP リクエストを行う必要があります。これらは <a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Third_party_APIs#A_RESTful_API_—_NYTimes">RESTful API と呼ばれ、後で例が出てきます</a>。</p>
</div>

<h3 id="通常は_API_キーが必要です">通常は API キーが必要です</h3>

<p><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Introduction#They_have_additional_security_mechanisms_where_appropriate">最初の記事で説明した</a>ように、ブラウザ API のセキュリティは許可プロンプトによって処理される傾向があります。これらの目的は、<span class="tlid-translation translation" lang="ja"><span title="">ユーザが訪問した Web サイトで何が起こっているのかをユーザ自身が認識できるようにし</span><span title="">、悪意のある方法で API を使用している人の被害にあう可能性を低くすることです。</span></span></p>

<p>サードパーティの API には、少し異なる権限システムがあります。開発者が API 機能にアクセスできるようにするために開発者キーを使用する傾向があります。</p>

<p>Mapquest API の例には、次のような行があります。</p>

<pre class="line-numbers language-html"><code class="language-html">L.mapquest.key = 'YOUR-API-KEY-HERE';</code></pre>

<p>この行では、アプリケーションで使用する API キーまたは開発者キーを指定します。アプリケーションの開発者は、キーを取得して API の機能へのアクセス許可を得るためにコードに含める必要があります。この例では、プレースホルダを用意しました。</p>

<div class="blockIndicator note">
<p><strong>メモ</strong>: 独自の例を作成するときは、プレースホルダの代わりに独自の API キーを使用します。</p>
</div>

<p>他の API では、少し異なる方法でキーを含める必要があるかもしれませんが、ほとんどのパターンは比較的似ています。</p>

<p>キーを要求することで、API プロバイダは API のユーザに自分のアクションに対する責任を持たせることができます。開発者がキーを登録すると、それらは API プロバイダに認識され、彼らが API に悪意のあることをし始めたらアクション  (たとえば、人々の位置を追跡したり、APIを機能させないために大量のリクエストでAPIをスパムしようとするなど) を取ることができます。最も簡単なアクションは、単にそれらの API 特権を取り消すことです。</p>

<h2 id="Mapquest_の例を拡張する">Mapquest の例を拡張する</h2>

<p>API の他の機能の使用方法を示すために、Mapquest の例にさらに機能を追加しましょう。</p>

<ol>
 <li>
  <p>この章を始めるにあたり、新しいディレクトリーに<a href="https://github.com/mdn/learning-area/blob/master/javascript/apis/third-party-apis/mapquest/starter-file.html">mapquest starter file</a>をコピーしましょう。もしもすでに<a href="https://developer.mozilla.org/en-US/docs/Learn#Getting_our_code_examples">examples repository</a>をクローンしているようなら、必要な<em>javascript/apis/third-party-apis/mapquest</em>を見つけてコピーしてください。</p>
 </li>
 <li>
  <p>次に<a href="https://developer.mapquest.com/">Mapquest developer site</a>に行ってください。 アカウントを作り、デベロッパーキーを使用してあなたのサンプルに利用してください。(アカウント作成時、デベロッパーキーは"consumer key"と呼ばれています。そして、 "callback URL"を尋ねられると思いますが、その入力欄は空欄でかまいません)</p>
 </li>
 <li>starting fileを開き、APIキーのプレスホルダーにあなたのキーを入力してください。</li>
</ol>

<h3 id="地図の種類を変更する">地図の種類を変更する</h3>

<p>Mapquest APIで表示できるマップには、さまざまな種類があります。 これを行うには、次の行を見つけます。</p>

<pre class="brush: js line-numbers language-js"><code class="language-js">layers<span class="punctuation token">:</span> <span class="constant token">L</span><span class="punctuation token">.</span>mapquest<span class="punctuation token">.</span><span class="function token">tileLayer</span><span class="punctuation token">(</span><span class="string token">'map'</span><span class="punctuation token">)</span></code></pre>

<p>hybrid-style mapにするために<code>'map'</code> を <code>'hybrid'</code>に変えてみてください。他にも様々な値があります。<a href="https://developer.mapquest.com/documentation/mapquest-js/v1.3/l-mapquest-tile-layer/"><code>tileLayer reference page</code></a> には使える様々なオプションや情報が載っています。</p>

<h3 id="さまざまなコントロールを追加する">さまざまなコントロールを追加する</h3>

<p>この地図には様々な機能を実装できますが、デフォルトでは、ズームコントロールのみが表示されます。<code>map.addControl()</code> メソッドを使うことで機能を拡張することが出来ます。以下のコードを<code>window.onload</code>ハンドラーに追加してみてください。</p>

<pre class="brush: js line-numbers language-js"><code class="language-js">map<span class="punctuation token">.</span><span class="function token">addControl</span><span class="punctuation token">(</span><span class="constant token">L</span><span class="punctuation token">.</span>mapquest<span class="punctuation token">.</span><span class="function token">control</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>The <a href="https://developer.mapquest.com/documentation/mapquest-js/v1.3/l-mapquest-control/"><code>mapquest.control()</code> method</a> just creates a simple full-featured control set, and it is placed in the top-right hand corner by default. You can adjust the position by specifying an options object as a parameter for the control containing a <code>position</code> property, the value of which is a string speciying a position for the control. Try this, for example:</p>

<pre class="brush: js line-numbers language-js"><code class="language-js">map<span class="punctuation token">.</span><span class="function token">addControl</span><span class="punctuation token">(</span><span class="constant token">L</span><span class="punctuation token">.</span>mapquest<span class="punctuation token">.</span><span class="function token">control</span><span class="punctuation token">(</span><span class="punctuation token">{</span> position<span class="punctuation token">:</span> <span class="string token">'bottomright'</span> <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>There are other types of control available, for example <code><a href="https://developer.mapquest.com/documentation/mapquest-js/v1.3/l-mapquest-search-control/">mapquest.searchControl()</a></code> and <code><a href="https://developer.mapquest.com/documentation/mapquest-js/v1.3/l-mapquest-satellite-control/">mapquest.satelliteControl()</a></code>, and some are quite complex and powerful. Have a play around and see what you can come up with.</p>

<h3 id="カスタムマーカーを追加する">カスタムマーカーを追加する</h3>

<p>Adding a marker (icon) at a certain point on the map is easy — you just use the <code><a href="https://leafletjs.com/reference-1.3.0.html#marker">L.marker()</a></code> method (which seems to be documented in the related Leaflet.js docs). Add the following code to your example, again inside <code>window.onload</code>:</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="constant token">L</span><span class="punctuation token">.</span><span class="function token">marker</span><span class="punctuation token">(</span><span class="punctuation token">[</span><span class="number token">53.480759</span><span class="punctuation token">,</span> <span class="operator token">-</span><span class="number token">2.242631</span><span class="punctuation token">]</span><span class="punctuation token">,</span> <span class="punctuation token">{</span>
  icon<span class="punctuation token">:</span> <span class="constant token">L</span><span class="punctuation token">.</span>mapquest<span class="punctuation token">.</span>icons<span class="punctuation token">.</span><span class="function token">marker</span><span class="punctuation token">(</span><span class="punctuation token">{</span>
    primaryColor<span class="punctuation token">:</span> <span class="string token">'#22407F'</span><span class="punctuation token">,</span>
    secondaryColor<span class="punctuation token">:</span> <span class="string token">'#3B5998'</span><span class="punctuation token">,</span>
    shadow<span class="punctuation token">:</span> <span class="boolean token">true</span><span class="punctuation token">,</span>
    size<span class="punctuation token">:</span> <span class="string token">'md'</span><span class="punctuation token">,</span>
    symbol<span class="punctuation token">:</span> <span class="string token">'A'</span>
  <span class="punctuation token">}</span><span class="punctuation token">)</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span>
<span class="punctuation token">.</span><span class="function token">bindPopup</span><span class="punctuation token">(</span><span class="string token">'This is Manchester!'</span><span class="punctuation token">)</span>
<span class="punctuation token">.</span><span class="function token">addTo</span><span class="punctuation token">(</span>map<span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>As you can see, this at its simplest takes two parameters, an array containing the coordinates at which to display the marker, and an options object containing an <code>icon</code> property that defines the icon to display at that point.</p>

<p>The icon is defined using an <code><a href="https://developer.mapquest.com/documentation/mapquest-js/v1.3/l-mapquest-icons/">mapquest.icons.marker()</a></code> method, which as you can see contains information such as color and size of marker.</p>

<p>Onto the end of the first method call we chain <code>.bindPopup('This is Manchester!')</code>, which defines content to display when the marker is clicked.</p>

<p>Finally, we chain <code>.addTo(map)</code> to the end of the chain to actually add the marker to the map.</p>

<p>Have a play with the other options shown in the documentation and see what you can come up with! Mapquest provides some pretty advanced functionality, such as directions, searching, etc.</p>

<div class="blockIndicator note">
<p><strong>Note</strong>: If you have trouble getting the example to work, check your code against our finished version — see <a href="https://github.com/mdn/learning-area/blob/master/javascript/apis/third-party-apis/mapquest/expanded-example.html">expanded-example.html</a>.</p>
</div>

<h2 id="Google_マップはどうですか？">Google マップはどうですか？</h2>

<p>Google Maps is arguably the most popular maps API, so why didn't we use it for our maps example? We did <a href="https://github.com/mdn/learning-area/blob/master/javascript/apis/third-party-apis/google-maps/finished-maps-example.html">create an example</a> to show how to use it, but in the end we went with Mapquest for a couple of reasons:</p>

<ul>
 <li>It is much easier to get started with. For Google APIs in general, you need to create a Google account and log into the <a href="https://console.cloud.google.com">Google Cloud Platform Console</a> to create API keys, etc., and the process is fairly complex. For the <a href="https://cloud.google.com/maps-platform/">Google Maps API</a> in particular, you need to provide a credit card for billing purposes (although basic usage is free), which we didn't think was acceptable for a basic tutorial.</li>
 <li>We wanted to show that there are other alternatives available.</li>
</ul>

<h2 id="RESTful_API_—_NYTimes_の例">RESTful API — NYTimes の例</h2>

<p>Now let's look at another API example — the <a href="https://developer.nytimes.com">New York Times API</a>. This API allows you to retrieve New York Times news story information and display it on your site. This type of API is known as a <strong>RESTful API</strong> — instead of getting data using the features of a JavaScript library like we did with Mapquest, we get data by making HTTP requests to specific URLs, with data like search terms and other properties encoded in the URL (often as URL parameters). This is a common pattern you'll encounter with APIs.</p>

<h2 id="An_approach_for_using_third-party_APIs">An approach for using third-party APIs</h2>

<p>Below we'll take you through an exercise to show you how to use the NYTimes API, which also provides a more general set of steps to follow that you can use as an approach for working with new APIs.</p>

<h3 id="Find_the_documentation">Find the documentation</h3>

<p>When you want to use a third party API, it is essential to find out where the documentation is, so you can find out what features the API has, how you use them, etc. The New York Times API documentation is at <a href="https://developer.nytimes.com/">https://developer.nytimes.com/</a>.</p>

<h3 id="Get_a_developer_key">Get a developer key</h3>

<p>Most APIs require you to use some kind of developer key, for reasons of security and accountability. To sign up for an NYTimes API key, following the instructions at <a href="https://developer.nytimes.com/get-started">https://developer.nytimes.com/get-started</a>.</p>

<ol>
 <li>
  <p>Let's request a key for the Article Search API — create a new app, selecting this as the API you want to use (fill in a name and description, toggle the switch under the "Article Search API" to the on position, and then click "Create").</p>
 </li>
 <li>
  <p>Get the API key from the resulting page.</p>
 </li>
 <li>
  <p>Now, to start the example off, make copies of <a href="https://github.com/mdn/learning-area/blob/master/javascript/apis/third-party-apis/nytimes/nytimes_start.html">nytimes_start.html</a> and <a href="https://github.com/mdn/learning-area/blob/master/javascript/apis/third-party-apis/nytimes/nytimes.css">nytimes.css</a> in a new directory on your computer. If you've already <a href="https://developer.mozilla.org/en-US/docs/Learn#Getting_our_code_examples">cloned the examples repository</a>, you'll already have a copy of these files, which you can find in the <em>javascript/apis/third-party-apis/nytimes</em> directory. Initially the <code>&lt;script&gt;</code> element contains a number of variables needed for the setup of the example; below we'll fill in the required functionality.</p>
 </li>
</ol>

<p>The app will end up allowing you to type in a search term and optional start and end dates, which it will then use to query the Article Search API and display the search results.</p>

<p><img alt="" src="https://mdn.mozillademos.org/files/14821/nytimes-search.png" style="border-style: solid; border-width: 1px; display: block; height: 374px; margin: 0px auto; width: 700px;"></p>

<h3 id="Connect_the_API_to_your_app">Connect the API to your app</h3>

<p>First, you'll need to make a connection between the API and your app. In the case of this API, you need to include the API key as a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET">get</a> parameter every time you request data from the service at the correct URL.</p>

<ol>
 <li>
  <p>Find the following line:</p>

  <pre class="brush: js line-numbers language-js"><code class="language-js"><span class="keyword token">var</span> key <span class="operator token">=</span> <span class="string token">' ... '</span><span class="punctuation token">;</span></code></pre>
 </li>
</ol>

<ul>
 <li>
  <p>Replace the existing API key with the actual API key you got in the previous section.</p>
 </li>
 <li>
  <p>Add the following line to your JavaScript, below the "<code>// Event listeners to control the functionality</code>" comment. This runs a function called <code>submitSearch()</code> when the form is submitted (the button is pressed).</p>

  <pre class="brush: js line-numbers language-js"><code class="language-js">searchForm<span class="punctuation token">.</span><span class="function token">addEventListener</span><span class="punctuation token">(</span><span class="string token">'submit'</span><span class="punctuation token">,</span> submitSearch<span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>
 </li>
 <li></li>
 <li>
  <p>Now add the <code>submitSearch()</code> and <code>fetchResults()</code> function definitions, below the previous line:</p>

  <pre class="brush: js line-numbers language-js"><code class="language-js"><span class="keyword token">function</span> <span class="function token">submitSearch</span><span class="punctuation token">(</span><span class="parameter token">e</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  pageNumber <span class="operator token">=</span> <span class="number token">0</span><span class="punctuation token">;</span>
  <span class="function token">fetchResults</span><span class="punctuation token">(</span>e<span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="keyword token">function</span> <span class="function token">fetchResults</span><span class="punctuation token">(</span><span class="parameter token">e</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  <span class="comment token">// Use preventDefault() to stop the form submitting</span>
  e<span class="punctuation token">.</span><span class="function token">preventDefault</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span>

  <span class="comment token">// Assemble the full URL</span>
  url <span class="operator token">=</span> baseURL <span class="operator token">+</span> <span class="string token">'?api-key='</span> <span class="operator token">+</span> key <span class="operator token">+</span> <span class="string token">'&amp;page='</span> <span class="operator token">+</span> pageNumber <span class="operator token">+</span> <span class="string token">'&amp;q='</span> <span class="operator token">+</span> searchTerm<span class="punctuation token">.</span>value <span class="operator token">+</span> <span class="string token">'&amp;fq=document_type:("article")'</span><span class="punctuation token">;</span>

  <span class="keyword token">if</span><span class="punctuation token">(</span>startDate<span class="punctuation token">.</span>value <span class="operator token">!==</span> <span class="string token">''</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    url <span class="operator token">+=</span> <span class="string token">'&amp;begin_date='</span> <span class="operator token">+</span> startDate<span class="punctuation token">.</span>value<span class="punctuation token">;</span>
  <span class="punctuation token">}</span><span class="punctuation token">;</span>

  <span class="keyword token">if</span><span class="punctuation token">(</span>endDate<span class="punctuation token">.</span>value <span class="operator token">!==</span> <span class="string token">''</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    url <span class="operator token">+=</span> <span class="string token">'&amp;end_date='</span> <span class="operator token">+</span> endDate<span class="punctuation token">.</span>value<span class="punctuation token">;</span>
  <span class="punctuation token">}</span><span class="punctuation token">;</span>

<span class="punctuation token">}</span></code></pre>
 </li>
</ul>

<ol>
 <li></li>
</ol>

<p><code>submitSearch()</code> sets the page number back to 0 to begin with, then calls <code>fetchResults()</code>. This first calls <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault">preventDefault()</a></code> on the event object, to stop the form actually submitting (which would break the example). Next, we use some string manipulation to assemble the full URL that we will make the request to. We start off by assembling the parts we deem as mandatory for this demo:</p>

<ul>
 <li>The base URL (taken from the <code>baseURL</code> variable).</li>
 <li>The API key, which has to be specified in the <code>api-key</code> URL parameter (the value is taken from the <code>key</code> variable).</li>
 <li>The page number, which has to be specified in the <code>page</code> URL parameter (the value is taken from the <code>pageNumber</code> variable).</li>
 <li>The search term, which has to be specified in the <code>q</code> URL parameter (the value is taken from the value of the <code>searchTerm</code> text {{htmlelement("input")}}).</li>
 <li>The document type to return results for, as specified in an expression passed in via the <code>fq</code> URL parameter. In this case, we want to return articles.</li>
</ul>

<p>Next, we use a couple of <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else">if()</a></code> statements to check whether the <code>startDate</code> and <code>endDate</code> <code>&lt;input&gt;</code>s have had values filled in on them. If they do, we append their values to the URL, specified in <code>begin_date</code> and <code>end_date</code> URL parameters respectively.</p>

<p>So, a complete URL would end up looking something like this:</p>

<pre class="line-numbers language-html"><code class="language-html">https://api.nytimes.com/svc/search/v2/articlesearch.json?api-key=YOUR-API-KEY-HERE&amp;page=0&amp;q=cats
&amp;fq=document_type:("article")&amp;begin_date=20170301&amp;end_date=20170312</code></pre>

<div class="note">
<p><strong>Note</strong>: You can find more details of what URL parameters can be included at the <a href="https://developer.nytimes.com/">NYTimes developer docs</a>.</p>
</div>

<div class="note">
<p><strong>Note</strong>: The example has rudimentary form data validation — the search term field has to be filled in before the form can be submitted (achieved using the <code>required</code> attribute), and the date fields have <code>pattern</code> attributes specified, which means they won't submit unless their values consist of 8 numbers (<code>pattern="[0-9]{8}"</code>). See <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Forms/Form_validation">Form data validation</a> for more details on how these work.</p>
</div>

<h3 id="Requesting_data_from_the_API">Requesting data from the API</h3>

<p>Now we've constructed our URL, let's make a request to it. We'll do this using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Fetch API</a>.</p>

<p>Add the following code block inside the <code>fetchResults()</code> function, just above the closing curly brace:</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="comment token">// Use fetch() to make the request to the API</span>
<span class="function token">fetch</span><span class="punctuation token">(</span>url<span class="punctuation token">)</span><span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span><span class="keyword token">function</span><span class="punctuation token">(</span><span class="parameter token">result</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  <span class="keyword token">return</span> result<span class="punctuation token">.</span><span class="function token">json</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span><span class="keyword token">function</span><span class="punctuation token">(</span><span class="parameter token">json</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  <span class="function token">displayResults</span><span class="punctuation token">(</span>json<span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>Here we run the request by passing our <code>url</code> variable to <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch">fetch()</a></code>, convert the response body to JSON using the <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Body/json">json()</a></code> function, then pass the resulting JSON to the <code>displayResults()</code> function so the data can be displayed in our UI.</p>

<h3 id="Displaying_the_data">Displaying the data</h3>

<p>OK, let's look at how we'll display the data. Add the following function below your <code>fetchResults()</code> function.</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="keyword token">function</span> <span class="function token">displayResults</span><span class="punctuation token">(</span><span class="parameter token">json</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  <span class="keyword token">while</span> <span class="punctuation token">(</span>section<span class="punctuation token">.</span>firstChild<span class="punctuation token">)</span> <span class="punctuation token">{</span>
      section<span class="punctuation token">.</span><span class="function token">removeChild</span><span class="punctuation token">(</span>section<span class="punctuation token">.</span>firstChild<span class="punctuation token">)</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span>

  <span class="keyword token">var</span> articles <span class="operator token">=</span> json<span class="punctuation token">.</span>response<span class="punctuation token">.</span>docs<span class="punctuation token">;</span>

  <span class="keyword token">if</span><span class="punctuation token">(</span>articles<span class="punctuation token">.</span>length <span class="operator token">===</span> <span class="number token">10</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    nav<span class="punctuation token">.</span>style<span class="punctuation token">.</span>display <span class="operator token">=</span> <span class="string token">'block'</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span> <span class="keyword token">else</span> <span class="punctuation token">{</span>
    nav<span class="punctuation token">.</span>style<span class="punctuation token">.</span>display <span class="operator token">=</span> <span class="string token">'none'</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span>

  <span class="keyword token">if</span><span class="punctuation token">(</span>articles<span class="punctuation token">.</span>length <span class="operator token">===</span> <span class="number token">0</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    <span class="keyword token">var</span> para <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'p'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    para<span class="punctuation token">.</span>textContent <span class="operator token">=</span> <span class="string token">'No results returned.'</span>
    section<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>para<span class="punctuation token">)</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span> <span class="keyword token">else</span> <span class="punctuation token">{</span>
    <span class="keyword token">for</span><span class="punctuation token">(</span><span class="keyword token">var</span> i <span class="operator token">=</span> <span class="number token">0</span><span class="punctuation token">;</span> i <span class="operator token">&lt;</span> articles<span class="punctuation token">.</span>length<span class="punctuation token">;</span> i<span class="operator token">++</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      <span class="keyword token">var</span> article <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'article'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="keyword token">var</span> heading <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'h2'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="keyword token">var</span> link <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'a'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="keyword token">var</span> img <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'img'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="keyword token">var</span> para1 <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'p'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="keyword token">var</span> para2 <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'p'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="keyword token">var</span> clearfix <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'div'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>

      <span class="keyword token">var</span> current <span class="operator token">=</span> articles<span class="punctuation token">[</span>i<span class="punctuation token">]</span><span class="punctuation token">;</span>
      console<span class="punctuation token">.</span><span class="function token">log</span><span class="punctuation token">(</span>current<span class="punctuation token">)</span><span class="punctuation token">;</span>

      link<span class="punctuation token">.</span>href <span class="operator token">=</span> current<span class="punctuation token">.</span>web_url<span class="punctuation token">;</span>
      link<span class="punctuation token">.</span>textContent <span class="operator token">=</span> current<span class="punctuation token">.</span>headline<span class="punctuation token">.</span>main<span class="punctuation token">;</span>
      para1<span class="punctuation token">.</span>textContent <span class="operator token">=</span> current<span class="punctuation token">.</span>snippet<span class="punctuation token">;</span>
      para2<span class="punctuation token">.</span>textContent <span class="operator token">=</span> <span class="string token">'Keywords: '</span><span class="punctuation token">;</span>
      <span class="keyword token">for</span><span class="punctuation token">(</span><span class="keyword token">var</span> j <span class="operator token">=</span> <span class="number token">0</span><span class="punctuation token">;</span> j <span class="operator token">&lt;</span> current<span class="punctuation token">.</span>keywords<span class="punctuation token">.</span>length<span class="punctuation token">;</span> j<span class="operator token">++</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
        <span class="keyword token">var</span> span <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">'span'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
        span<span class="punctuation token">.</span>textContent <span class="operator token">+=</span> current<span class="punctuation token">.</span>keywords<span class="punctuation token">[</span>j<span class="punctuation token">]</span><span class="punctuation token">.</span>value <span class="operator token">+</span> <span class="string token">' '</span><span class="punctuation token">;</span>
        para2<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>span<span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="punctuation token">}</span>

      <span class="keyword token">if</span><span class="punctuation token">(</span>current<span class="punctuation token">.</span>multimedia<span class="punctuation token">.</span>length <span class="operator token">&gt;</span> <span class="number token">0</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
        img<span class="punctuation token">.</span>src <span class="operator token">=</span> <span class="string token">'http://www.nytimes.com/'</span> <span class="operator token">+</span> current<span class="punctuation token">.</span>multimedia<span class="punctuation token">[</span><span class="number token">0</span><span class="punctuation token">]</span><span class="punctuation token">.</span>url<span class="punctuation token">;</span>
        img<span class="punctuation token">.</span>alt <span class="operator token">=</span> current<span class="punctuation token">.</span>headline<span class="punctuation token">.</span>main<span class="punctuation token">;</span>
      <span class="punctuation token">}</span>

      clearfix<span class="punctuation token">.</span><span class="function token">setAttribute</span><span class="punctuation token">(</span><span class="string token">'class'</span><span class="punctuation token">,</span><span class="string token">'clearfix'</span><span class="punctuation token">)</span><span class="punctuation token">;</span>

      article<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>heading<span class="punctuation token">)</span><span class="punctuation token">;</span>
      heading<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>link<span class="punctuation token">)</span><span class="punctuation token">;</span>
      article<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>img<span class="punctuation token">)</span><span class="punctuation token">;</span>
      article<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>para1<span class="punctuation token">)</span><span class="punctuation token">;</span>
      article<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>para2<span class="punctuation token">)</span><span class="punctuation token">;</span>
      article<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>clearfix<span class="punctuation token">)</span><span class="punctuation token">;</span>
      section<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>article<span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>
  <span class="punctuation token">}</span>
<span class="punctuation token">}</span></code></pre>

<p>There's a lot of code here; let's explain it step by step:</p>

<ul>
 <li>The <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/while">while</a></code> loop is a common pattern used to delete all of the contents of a DOM element, in this case, the {{htmlelement("section")}} element. We keep checking to see if the <code>&lt;section&gt;</code> has a first child, and if it does, we remove the first child. The loop ends when <code>&lt;section&gt;</code> no longer has any children.</li>
 <li>Next, we set the <code>articles</code> variable to equal <code>json.response.docs</code> — this is the array holding all the objects that represent the articles returned by the search. This is done purely to make the following code a bit simpler.</li>
 <li>The first <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else">if()</a></code> block checks to see if 10 articles are returned (the API returns up to 10 articles at a time.) If so, we display the {{htmlelement("nav")}} that contains the <em>Previous 10</em>/<em>Next 10</em> pagination buttons. If less than 10 articles are returned, they will all fit on one page, so we don't need to show the pagination buttons. We will wire up the pagination functionality in the next section.</li>
 <li>The next <code>if()</code> block checks to see if no articles are returned. If so, we don't try to display any — we create a {{htmlelement("p")}} containing the text "No results returned." and insert it into the.<code>&lt;section&gt;</code></li>
 <li>If some articles are returned, we, first of all, create all the elements that we want to use to display each news story, insert the right contents into each one, and then insert them into the DOM at the appropriate places. To work out which properties in the article objects contained the right data to show, we consulted the Article Search API reference (see <a href="https://developer.nytimes.com/apis">NYTimes APIs</a>). Most of these operations are fairly obvious, but a few are worth calling out:
  <ul>
   <li>We used a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for">for loop</a> (<code>for(var j = 0; j &lt; current.keywords.length; j++) { ... }</code> ) to loop through all the keywords associated with each article, and insert each one inside its own {{htmlelement("span")}}, inside a <code>&lt;p&gt;</code>. This was done to make it easy to style each one.</li>
   <li>We used an <code>if()</code> block (<code>if(current.multimedia.length &gt; 0) { ... }</code>) to check whether each article has any images associated with it (some stories don't.) We display the first image only if it exists (otherwise an error would be thrown).</li>
   <li>We gave our <code>&lt;div&gt;</code> element a class of "clearfix", so we can easily apply clearing to it.</li>
  </ul>
 </li>
</ul>

<h3 id="Wiring_up_the_pagination_buttons">Wiring up the pagination buttons</h3>

<p>To make the pagination buttons work, we will increment (or decrement) the value of the <code>pageNumber</code> variable, and then re-rerun the fetch request with the new value included in the page URL parameter. This works because the NYTimes API only returns 10 results at a time — if more than 10 results are available, it will return the first 10 (0-9) if the <code>page</code> URL parameter is set to 0 (or not included at all — 0 is the default value), the next 10 (10-19) if it is set to 1, and so on.</p>

<p>This allows us to write a simplistic pagination function easily.</p>

<ol>
 <li>
  <p>Below the existing <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">addEventListener()</a></code> call, add these two new ones, which cause the <code>nextPage()</code> and <code>previousPage()</code> functions to be invoked when the relevant buttons are clicked:</p>

  <pre class="brush: js line-numbers language-js"><code class="language-js">nextBtn<span class="punctuation token">.</span><span class="function token">addEventListener</span><span class="punctuation token">(</span><span class="string token">'click'</span><span class="punctuation token">,</span> nextPage<span class="punctuation token">)</span><span class="punctuation token">;</span>
previousBtn<span class="punctuation token">.</span><span class="function token">addEventListener</span><span class="punctuation token">(</span><span class="string token">'click'</span><span class="punctuation token">,</span> previousPage<span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>
 </li>
</ol>

<ul>
 <li></li>
 <li>
  <p>Below your previous addition, let's define the two functions — add this code now:</p>

  <pre class="brush: js line-numbers language-js"><code class="language-js"><span class="keyword token">function</span> <span class="function token">nextPage</span><span class="punctuation token">(</span><span class="parameter token">e</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  pageNumber<span class="operator token">++</span><span class="punctuation token">;</span>
  <span class="function token">fetchResults</span><span class="punctuation token">(</span>e<span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span><span class="punctuation token">;</span>

<span class="keyword token">function</span> <span class="function token">previousPage</span><span class="punctuation token">(</span><span class="parameter token">e</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  <span class="keyword token">if</span><span class="punctuation token">(</span>pageNumber <span class="operator token">&gt;</span> <span class="number token">0</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    pageNumber<span class="operator token">--</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span> <span class="keyword token">else</span> <span class="punctuation token">{</span>
    <span class="keyword token">return</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span>
  <span class="function token">fetchResults</span><span class="punctuation token">(</span>e<span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span><span class="punctuation token">;</span></code></pre>
 </li>
</ul>

<ol>
 <li>
  <p>The first function is simple — we increment the <code>pageNumber</code> variable, then run the <code>fetchResults()</code> function again to display the next page's results.</p>

  <p>The second function works nearly exactly the same way in reverse, but we also have to take the extra step of checking that <code>pageNumber</code> is not already zero before decrementing it — if the fetch request runs with a minus <code>page</code> URL parameter, it could cause errors. If the <code>pageNumber</code> is already 0, we simply <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/return">return</a></code> out of the function, to avoid wasting processing power (If we are already at the first page, we don't need to load the same results again).</p>
 </li>
</ol>

<div class="blockIndicator note">
<p><strong>メモ</strong>: <a href="https://github.com/mdn/learning-area/blob/master/javascript/apis/third-party-apis/nytimes/index.html">完成したニューヨークタイムズの API サンプルコードは GitHub</a> にあります。</p>
</div>

<h2 id="YouTube_の例">YouTube の例</h2>

<p>We also built another example for you to study and learn from — see our <a href="https://github.com/mdn/learning-area/tree/master/javascript/apis/third-party-apis/youtube">YouTube video search example</a>. This uses two related APIs:</p>

<ul>
 <li>The <a href="https://developers.google.com/youtube/v3/docs/">YouTube Data API</a> to search for YouTube videos and return results.</li>
 <li>The <a href="https://developers.google.com/youtube/iframe_api_reference">YouTube IFrame Player API</a> to display the returned video examples inside IFrame video players so you can watch them.</li>
</ul>

<p>This example is interesting because it shows two related third-party APIs being used together to build an app. The first one is a RESTful API, while the second one works more like Mapquest (with API-specific methods, etc.). It is worth noting however that both of the APIs require a JavaScript library to be applied to the page. The RESTful API has functions available to handle making the HTTP requests and returning the results.</p>

<p><img alt="" src="https://mdn.mozillademos.org/files/14823/youtube-example.png" style="border-style: solid; border-width: 1px; display: block; height: 389px; margin: 0px auto; width: 700px;"></p>

<p>We are not going to say too much more about this example in the article — <a href="https://github.com/mdn/learning-area/tree/master/javascript/apis/third-party-apis/youtube">the source code</a> has detailed comments inserted inside it to explain how it works. You'll still need to get an API key and insert it into the code to get it working, like with the other examples.</p>

<h2 id="まとめ">まとめ</h2>

<p>この記事では、サードパーティ API を使用して Web サイトに機能を追加するための便利な方法を紹介しました。</p>

<p>{{PreviousMenuNext("Learn/JavaScript/Client-side_web_APIs/Fetching_data", "Learn/JavaScript/Client-side_web_APIs/Drawing_graphics", "Learn/JavaScript/Client-side_web_APIs")}}</p>

<h2 id="このモジュール">このモジュール</h2>

<div>
<ul>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Introduction">Web API の紹介</a></li>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Manipulating_documents">ドキュメントの操作</a></li>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Fetching_data">サーバからのデータ取得</a></li>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Third_party_APIs">サードパーティ API</a></li>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Drawing_graphics">グラフィックの描画</a></li>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Video_and_audio_APIs">動画と音声の API</a></li>
 <li><a href="/ja/docs/Learn/JavaScript/Client-side_web_APIs/Client-side_storage">クライアント側ストレージ</a></li>
</ul>
</div>