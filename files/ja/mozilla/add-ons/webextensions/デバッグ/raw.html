<div>{{AddonSidebar}}</div>

<div>この記事では、拡張機能をデバッグするのに Firefox 開発ツールをどのように使うのか説明します。</div>

<div></div>

<p>拡張機能は様々な異なる部品から構成されています — バックグラウンドスクリプト、ポップアップ、オプションページ、コンテンツスクリプト、サイドバー — 、そしてそれぞれの部品をデバッグするのに少しずつ違った作業フローを使う必要があります。それぞれの部品について、この記事に節があり、これらの節を個別に読むことができます。開発ツールの紹介から始めます、これは拡張機能のすべての部品をデバッグするために利用されます。</p>

<ul>
</ul>

<h2 id="The_Add-on_Debugger" name="The_Add-on_Debugger">開発ツールのツールボックス</h2>

<p>拡張機能のデバッグに使うのは開発ツールの実装で、ツールボックスと呼ばれます。ツールボックスを開くには:</p>

<ul>
 <li>URL バーで <code>about</code><code>:debugging</code> と入力する</li>
 <li>左側のメニューで、<strong>この Firefox</strong> (または <strong>この Nightly</strong>) をクリックする</li>
 <li>拡張機能の横の <strong>デバッグ</strong> ボタンをクリックする</li>
</ul>

<p>新しいタブが開き、<strong>インスペクター</strong>がツールボックスの中に表示されます。</p>

<p><code><img alt="Initial developer tools view, following a click on Inspect against an extension in about:debugging, showing the inspector" src="https://mdn.mozillademos.org/files/16691/developing_tools_inspector.png" style="height: 542px; width: 962px;"></code></p>

<p>拡張機能をデバッグするには:</p>

<ul>
 <li><a href="/ja/docs/Tools/Page_Inspector">インスペクター</a>: 拡張機能のページを構築するのに使われている HTML と CSS を検査したり変更することができます。</li>
 <li><a href="/ja/docs/Tools/Web_Console">コンソール</a>: 張機能がログ出力したメッセージとブラウザーが拡張機能を実行する時にログ出力するエラーメッセージを表示します。コマンドラインも提供し、拡張機能のコンテキストで JavaScript を実行できます。</li>
 <li><a href="/ja/docs/Tools/Debugger">デバッガー</a>: 拡張機能の JavaScript にブレークポイントやウォッチポイントを設定したり、内部状態を検査、変更することができます。</li>
</ul>

<p>デバッグ作業のほとんどで、<strong>コンソール</strong> と <strong>インスペクター</strong> または <strong>デバッガー</strong>を一緒に表示できると便利です。これは <a href="https://developer.mozilla.org/ja/docs/Tools/Web_Console/Split_console">split console</a> を使うと可能で、<kbd>esc</kbd> キーを押すとこのモードになります。</p>

<p><img alt="Following a click on Inspect against an extension in about:debugging, the initial developer tools view shows the inspector. Here we have turned on the split view as well." src="https://mdn.mozillademos.org/files/16692/developing_tools_inspector_split.png" style="height: 542px; width: 962px;"></p>

<p>ツールボックスのタブをドラッグすると独立したウィンドウにできるので、拡張機能を実行しているウィンドウの隣に配置することもできます。</p>

<p><img alt="Drag the toolbox to a new window, so you can observe it alongside your executing extension." src="https://mdn.mozillademos.org/files/16696/arranging_tools.png"></p>

<h2 id="Debugging_background_scripts" name="Debugging_background_scripts">バックグラウンドスクリプトをデバッグする</h2>

<div class="note">
<p>この節の例は "notify-link-clicks-l10n" という拡張機能の例を使います。続けたいならば、<a href="https://github.com/mdn/webextensions-examples">webextensions-examples</a> リポジトリでこの例を探すことができます。</p>
</div>

<p><a href="/ja/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Background_scripts">バックグラウンドスクリプト</a>を使うと、ウェブページやブラウザーウィンドウと独立して、拡張機能の長い期間の状態や長い期間の操作ができます。バックグラウンドスクリプトは非表示の "バックグラウンドページ" の中にロードされます: 既定では空の HTML ドキュメントですが、<a href="/ja/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background">"manifest.json" の <code>"background"</code> キー</a> を使ってカスタムページを指定してバックグラウンドページを定義できます。<br>
 バックグラウンドスクリプトをデバッグするには、<a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> ビューで<a href="https://wiki.developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/%E3%83%87%E3%83%90%E3%83%83%E3%82%B0$edit#Developer_tools_toolbox">Toolbox</a> <strong>Debugger</strong> を使って <strong>Debugger</strong> の下に <strong>Console</strong> が見られるようにします。</p>

<p>開始するには、<strong>Sources</strong> でバックグラウンドスクリプトを開きます。</p>

<p><img alt="Opening a background script from the sources panel" src="https://mdn.mozillademos.org/files/16694/locate_background_script.png" style="height: 542px; width: 962px;"></p>

<p>アドオンデバッガーの<strong>コンソール</strong>では、自身のバックグラウンドスクリプトからの <code><a href="/ja/docs/Web/API/Console/log">console.log()</a></code> の呼び出しやブラウザーが実行中に発生させたエラーを含んだ、ログ出力を見ることができます。この時、コンソールが拡張機能のコードに関連するエラーだけでなく、ブラウザーによって発生するすべてのエラーを表示することに注意してください。</p>

<p>例えば、<a href="https://github.com/mdn/webextensions-examples/tree/master/notify-link-clicks-i18n">notify-link-clicks-i18n</a> の拡張機能の例は、コンテンツスクリプトの 1 つからメッセージを受け取った時のバックグラウンドからのメッセージをログ出力します:</p>

<p><img alt="As the background script executes the console shows any messages generated by console.log" src="https://mdn.mozillademos.org/files/16697/background_script_console_log.png"></p>

<p><strong>コンソール</strong>のコマンドラインを使って、バックグラウンドスクリプトによって生成されたオブジェクトにアクセスや修正ができます。例えば、ここで <code>notify()</code> 関数を呼び出すことができます:</p>

<p><img alt="Functions in the extension can be run from the console." src="https://mdn.mozillademos.org/files/16698/execute_from_console.png" style="height: 540px; width: 960px;"></p>

<p><strong>デバッガー</strong>に切り替えた場合、ブレークポイントを設定したり、コードをステップ実行したり、拡張機能の状態を変更するといった、<a href="https://developer.mozilla.org/ja/docs/Tools/Debugger">デバッガーでできるすべてを実行できます</a>。</p>

<p><img alt="The developer tools debugger enables you to perform the usual debugger tasks, such as adding breakpoints" src="https://mdn.mozillademos.org/files/16699/adding_breakpoint.png" style="height: 540px; width: 960px;"></p>

<p>デバッガーの使い方のより詳細は、<a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Debugger">Debugger</a> ガイドを見てください。</p>

<h2 id="Debugging_options_pages" name="Debugging_options_pages">オプションページをデバッグする</h2>

<div class="blockIndicator note">
<p>We use the <a href="https://github.com/mdn/webextensions-examples/tree/master/favourite-colourbeastify">favourite-colour</a> extension example to illustrate the debugging features relevant to options pages. This example is in the <a href="https://github.com/mdn/webextensions-examples">webextensions-examples</a> repository.</p>
</div>

<p><a href="/ja/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Options_pages">オプションページ</a> は拡張機能の開発者が提供する HTML ページで、拡張機能のオプションを含みます。通常はアドオンマネージャー (アドオンマネージャーを見るには "about:addons" ページに移動します) の iframe 内に表示されます。 You use an options page to enable the user to set and save options and settings that affect the behavior of your extension. Options pages display in an iframe in Add-ons Manager.</p>

<p>オプションページをデバッグするには<a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> ビューで<a href="https://wiki.developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/%E3%83%87%E3%83%90%E3%83%83%E3%82%B0$edit#Developer_tools_toolbox">Toolbox</a> <strong>Debugger</strong> を使って <strong>Debugger</strong> の下に <strong>Console</strong> が見られるようにします。</p>

<p>開始するには:</p>

<ul>
 <li> URLバーで <code>about</code><code>:addons</code> と入力し、アドオンマネージャーを開きます。</li>
 <li>拡張機能の設定を開きます:<br>
  <img alt="To debug an options page, first, open the extension's preferences from Add-on Manager." src="https://mdn.mozillademos.org/files/16704/open_preferences.png" style="height: 85px; width: 683px;"></li>
 <li><strong>Sources</strong>.でオプションページを指定します。</li>
</ul>

<p><img alt="With your extension's preferences page open, you can locate any scripts from the page in the debugger." src="https://mdn.mozillademos.org/files/16705/options_script_in_debugger.png" style="height: 542px; width: 962px;"></p>

<p><strong>デバッガー</strong>に切り替えた場合、ブレークポイントを設定したり、コードをステップ実行したり、拡張機能の状態を変更するといった、<a href="https://developer.mozilla.org/ja/docs/Tools/Debugger">デバッガーでできるすべてを実行できます</a>。アドオンデバッガーの<strong>コンソール</strong>にコードからログ出力されたあらゆるメッセージも見ることができるでしょう。</p>

<p>ページの HTML と CSS をデバッグするためにアドオンデバッガーを使うことができます。まず、オプションページを実行する iframe でツールを指定する必要があります。これをするには:</p>

<ul>
 <li><strong>Inspector</strong>に切り替えます</li>
 <li>ページセレクター(1)をクリック</li>
 <li>オプションページの HTML項目 (2)をクリック</li>
</ul>

<p><img alt="Selecting the iframe containing an options page's HTML to open it in Inspector." src="https://mdn.mozillademos.org/files/16706/open_options_page_HTML.png" style="height: 542px; width: 962px;"></p>

<p><strong>インスペクタ</strong>の使い方のより詳細は、 <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Page_Inspector">Inspector</a> ガイドを見てください。</p>

<h2 id="Debugging_popups" name="Debugging_popups">ポップアップをデバッグする</h2>

<div class="blockIndicator note">
<p>We use the <a href="https://github.com/mdn/webextensions-examples/tree/master/beastify">beastify</a> extension example to illustrate the debugging features relevant to popups. This example is in the <a href="https://github.com/mdn/webextensions-examples">webextensions-examples</a> repository.</p>
</div>

<p><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/Popups">ポップアップ</a> はブラウザーアクションやページアクションに付随するダイアログです。スタイリングや振る舞いのための CSS と JavaScript のソースを含んだ HTML 文書を使って指定されます。ポップアップが見えている時は、コードをデバッグするのに <a href="/ja/Add-ons/WebExtensions/Debugging_(Firefox_50_onwards)#The_Add-on_Debugger">アドオンデバッガー</a> が使用できます。</p>

<p>ポップアップの問題の 1 つに、ポップアップを開いてポップアップの外側をクリックした場合、ポップアップが閉じ、コードがアンロードされることがあります。これは明らかにデバッグをできなくします。この振る舞いを抑制するには、下記のような省略メニューからポップアップを自動的に隠すの無効化を選択します:</p>

<p><strong>Auto-Hide</strong>.</p>

<p><img alt="To enable popups to remain visible and be available to debug, turn on the disable popup auto-hide option" src="https://mdn.mozillademos.org/files/16708/disable_popup_auto_hide.png" style="height: 542px; width: 985px;"></p>

<p>ここで、ポップアップを開くと、エスケープを押すまで開いたままになります。</p>

<div class="note">
<p><strong>注記:</strong> popup auto-hide の無効化は、省略メニュー (<code>...</code>) といった 組み込みのブラウザーポップアップにも適用されます。設定はセッション間で永続化されません。ウィンドウを閉じると、設定はポップアップを自動的に隠すに戻ります。</p>
内部的には、このボタンは <code>ui.popup.disable_autohide</code> の設定を切り替えるだけなので、<code>about:config</code> を使って切り替えることもできます。</div>

<p>ポップアップが開いた時、JavaScript ソースが<strong>デバッガー</strong>に一覧表示されます。<strong>デバッガー</strong>に切り替えた場合、ブレークポイントを設定したり、コードをステップ実行したり、拡張機能の状態を変更するといった、<a href="https://developer.mozilla.org/ja/docs/Tools/Debugger">デバッガーでできるすべてを実行できます</a>。アドオンデバッガーの<strong>コンソール</strong>にコードからログ出力されたあらゆるメッセージも見ることができるでしょう。</p>

<p><img alt="With the popup auto-hide disabled, you can locate its JavaScript in the debugger" src="https://mdn.mozillademos.org/files/16718/popup_in_debugger.png" style="height: 542px; width: 962px;"></p>

<p>To inspect the popup's HTML and CSS, use <strong>Inspector</strong> in the <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> view so you can view the <strong>Console</strong> below <strong>Inspector</strong>. You can <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Page_Inspector">review and modify the popup's HTML and CSS in <strong>Inspector</strong>,</a> as you would with any webpage.</p>

<p><img alt="With popup auto-hide disabled, you can inspect the popup page's HTML and CSS in Inspector." src="https://mdn.mozillademos.org/files/16719/popup_in_inspector.png" style="height: 542px; width: 962px;"></p>

<p>If your extension has multiple HTML documents open, click the page select icon (<img alt="If your extension has multiple pages open, use the page selector to load the one you want to review in Inspector." src="https://mdn.mozillademos.org/files/16720/page_selector.png" style="height: 18px; width: 20px;">) to open the popup's document.</p>

<h2 id="Debugging_content_scripts" name="Debugging_content_scripts">コンテンツスクリプトをデバッグする</h2>

<div class="blockIndicator note">
<p>We use the <a href="https://github.com/mdn/webextensions-examples/tree/master/notify-link-clicks-i18n">notify-link-clicks-i18n</a> extension example to illustrate the debugging features relevant to content scripts. This example is in the <a href="https://github.com/mdn/webextensions-examples">webextensions-examples</a> repository.</p>
</div>

<p>A <a href="https://wiki.developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">content script</a> is a part of your extension that runs in the context of a webpage; it enables your extension to react to events on the webpage and make changes to a webpage's content.</p>

<p>これは <a href="/ja/docs/Mozilla/Firefox/Multiprocess_Firefox">マルチプロセス Firefox</a> では、コンテンツスクリプトが拡張機能の他の部品とは違うプロセスで実行されるためです。このため、コンテンツスクリプトをデバッグするには、そのページの通常のウェブ開発ツールを使用します:</p>

<ul>
 <li>Firefox メニュー (あるいは、メニューバーを表示していたり Mac OS X では、<strong>ツール</strong>メニュー) の<strong>ウェブ開発</strong>のサブメニューから「開発ツールを表示」を選ぶか</li>
 <li>または <kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>i</kbd> (OS X では  <kbd>Command</kbd><kbd>Option</kbd><kbd>i</kbd> on ) のキーボードショートカットを押す。</li>
</ul>

<p>If you've already activated the <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> view, so you can view the <strong>Console</strong> below <strong>Debugger</strong>, the tools open in this mode. Otherwise, press <kbd>esc</kbd> to activate this mode.</p>

<p><img alt="You debug content scripts in the page in which they are injected using the standard web developer tools." src="https://mdn.mozillademos.org/files/16721/content_script_in_debug.png" style="height: 846px; width: 962px;"></p>

<p>Select your content scripts listed in <strong>Sources</strong>. You can set breakpoints, step through code, modify the extension's state, and do <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Debugger">everything else you'd expect to be able to do in a debugger</a>. Any messages logged by your code display in <strong>Console</strong>.</p>

<div class="note">
<p>開発ツールタブはコンテンツスクリプトが注入された時点ではまだ開いておらず、コンテンツスクリプトは<strong>Sources</strong>に一覧表示されないことがあります。この状態になった場合、開発ツールタブが開いているページをリロードすると問題は改修されます。</p>
</div>

<h2 id="Debugging_sidebars" name="Debugging_sidebars">サイドバーをデバッグする</h2>

<div class="blockIndicator note">
<p>We use the <a class="external external-icon" href="https://github.com/mdn/webextensions-examples/tree/master/annotate-page" rel="noopener">annotate-page</a> extension example to illustrate the debugging features relevant to sidebars. This example is in the <a href="https://github.com/mdn/webextensions-examples">webextensions-examples</a> repository.</p>
</div>

<p><a href="/ja/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">サイドバー</a> は拡張機能の開発者が提供できるブラウザー UI でサイドバーとして開かれる HTML ページです。</p>

<p>サイドバーをデバッグするには、 use the <a href="https://wiki.developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/%E3%83%87%E3%83%90%E3%83%83%E3%82%B0$edit#Developer_tools_toolbox">Toolbox</a> <strong>Debugger</strong> in the <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> view so you can view the <strong>Console</strong> below <strong>Debugger</strong>.</p>

<p>To debug a sidebar, open the sidebar and locate its JavaScript in <strong>Debugger</strong>.</p>

<p><img alt="With an extension's sidebar open, the sidebar's JavaScript can be debugged." src="https://mdn.mozillademos.org/files/16723/sidebar_script_in_debugger.png" style="height: 542px; width: 963px;"></p>

<p>In the <strong>Debugger</strong> you can set breakpoints, step through code, modify the extension's state, and do <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Debugger">everything else you'd expect to be able to do in a debugger</a>. またアドオンデバッガーコンソールでコードがログ出力したあらゆるメッセージを確認できます。</p>

<p>To inspect the sidebar's HTML and CSS, use <strong>Inspector</strong> in the <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> view so you can view the <strong>Console</strong> below <strong>Inspector</strong>. You can <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Page_Inspector">review and modify the sidebar's HTML and CSS in <strong>Inspector</strong>,</a> as you would with any webpage.</p>

<p><img alt="With an extension's sidebar open, the sidebar document's HTML and CSS can be inspected." src="https://mdn.mozillademos.org/files/16722/sidebar_page_in_inspector.png" style="height: 542px; width: 962px;"></p>

<p>If your extension has multiple HTML documents open, click the page select icon (<img alt="If your extension has multiple pages open, use the page selector to load the one you want to review in Inspector." src="https://mdn.mozillademos.org/files/16720/page_selector.png" style="height: 18px; width: 20px;">) to open the sidebar's document.</p>

<h2 id="Debugging_developer_tools_pages_panels" name="Debugging_developer_tools_pages_panels">開発ツールページとパネルをデバッグする</h2>

<div class="blockIndicator note">
<p>We use the <a href="https://github.com/mdn/webextensions-examples/tree/master/devtools-panels">devtools-panels</a> extension example to illustrate the debugging features relevant to developer tools pages and panels. This example is in the <a href="https://github.com/mdn/webextensions-examples">webextensions-examples</a> repository.</p>
</div>

<p><a href="/ja/Add-ons/WebExtensions/Extending_the_developer_tools">開発ツール</a> は開発ツールが開かれた時に隠れた HTML ページをロードすることで拡張され、<a href="/ja/docs/Mozilla/Add-ons/WebExtensions/API/devtools.panels/create">開発ツールパネル</a> は拡張機能の開発者が提供できるブラウザー UI で開発ツールとして表示される HTML ページです。</p>

<p>To debug development tools pages and panels, use the <a href="https://wiki.developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/%E3%83%87%E3%83%90%E3%83%83%E3%82%B0$edit#Developer_tools_toolbox">Toolbox</a> <strong>Debugger</strong> in the <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Web_Console/Split_console">split console</a> view so you can view the <strong>Console</strong> below <strong>Debugger</strong>.</p>

<p>To debug additions to the developer tools, open the developer tools and any custom panels, and locate their JavaScript in <strong>Debugger</strong>.</p>

<p><img alt="With the developer tools open and any panels added visible, JavaScript associated with developer tools extensions is visible in the debugger." src="https://mdn.mozillademos.org/files/16724/developer_tools_in_debugger.png" style="height: 542px; width: 962px;"></p>

<p>In the <strong>Debugger</strong> you can set breakpoints, step through code, modify the extension's state, and do <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Debugger">everything else you'd expect to be able to do in a debugger</a>. またアドオンデバッガーコンソールでコードがログ出力したあらゆるメッセージを確認できます。</p>

<p>To debug the custom developer tools pages' HTML and CSS:</p>

<ul>
 <li>switch to <strong>Inspector</strong>.</li>
 <li>click the page selector (1).</li>
 <li>click the custom development tools page item you want to inspect (2).</li>
</ul>

<p><img alt="With the developer tools open and any panels added visible, the HTML documents associated with developer tools extensions can be selected in inspector so that their HTML and CSS can be inspected." src="https://mdn.mozillademos.org/files/16725/developer_tools_selecting_page_in_inspector.png" style="height: 542px; width: 962px;"></p>

<p>You can <a href="https://wiki.developer.mozilla.org/en-US/docs/Tools/Page_Inspector">review and modify the custom development tools page HTML and CSS in <strong>Inspector</strong>,</a> as you would with any webpage.</p>

<h2 id="Debug_permission_requests" name="Debug_permission_requests">パーミッションリクエストをデバッグする</h2>

<p> パーミッションリクエストのデバッグについては、<a href="https://developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/Test_permission_requests">Test permission requests</a> をご覧ください。</p>

<h2 id="Debugging_Browser_Restarts" name="Debugging_Browser_Restarts">ブラウザーの再起動をデバッグする</h2>

<p>ブラウザーの再起動、それによりセッションが回復する、によって影響を受ける状態で拡張機能が有効化しているならば、そういった状況でコードの動作が予想通りであるかを確かめる追加検証を行なったほうがいいでしょう。</p>

<p>詳細は <a href="https://developer.mozilla.org/ja/docs/Mozilla/Add-ons/WebExtensions/Testing_persistent_and_restart_features">テストの持続と再起動機能</a> をご覧ください。</p>