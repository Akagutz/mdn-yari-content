<h2 class="heading-secondary" id="在_Windows_上編譯_Firefox">在 Windows 上編譯 Firefox</h2>

<p>感謝您幫助我們編譯這個用在世界最知名的作業系統上，世界上最好的瀏覽器。這份文件將幫助您可以在自己的設備上建立環境來編譯並黑客自己獨有版本的 Firefox。</p>

<p>建立環境並不困難，但她需要一點時間，我們將需要下載大量的 bytes！就算是在一個快速網路下，仍然可能會花十幾分鐘來下載，最常甚至可能到一兩個小時。</p>

<p>詳細步驟在這業的下方，但這份快速上手的指引將讓您建立起來並運作：</p>

<h3 class="heading-tertiary" id="事先準備">事先準備</h3>

<p>To build Firefox on Windows, you need a 64-bit version of Windows 7 or later and about 40 GB of free space on your hard drive . You can make sure your version of Windows is 64-bit on Windows 7 by right-clicking Computer in your Start menu, clicking Properties and then System. On Windows 8.1 and Windows 10, right-clicking the Windows menu button and choosing System will show you the same information. You can alternatively press Win + Pause Break on your keyboard on any version of Windows.</p>

<p>Next, we want to start on a solid foundation: make sure you’re up to date with Windows Update and then we’ll get moving.</p>

<h3 class="heading-tertiary" id="Visual_Studio_2015">Visual Studio 2015</h3>

<p>目前官方是使用 Visual Studio 2015 來編譯。 To use it, download and install <a href="https://www.visualstudio.com/vs/older-downloads/">Visual Studio Community 2015 Update 3</a> from Microsoft (warning : current version is now Visual Studio 2017, so to get exactly the 2015 update 3 version with the link above, you need to go to the "Download" section", then choose "Visual Studio Community 2015 with Update 3" and then download it, but you can also use Visual Studio 2017, see next section below). If you have an earlier version of Visual Studio, you'll need to upgrade; Firefox relies on C++ features that aren't supported in older versions of Visual Studio. Do not accept the default configuration. Instead, select <strong>Programming Languages</strong> &gt; <strong>Visual C++</strong> &gt; <strong>Common Tools for Visual C++ 2015</strong>. This option is required for Rust. After installation, be sure to Launch Visual Studio 2015 from the GUI to complete the first time run procedure to associate this installation with an account.  Otherwise, you will be running an evaluation version which will not properly update via Windows Update.</p>

<p>Next, you need to download and install the <a href="https://msdn.microsoft.com/en-us/library/mt752379.aspx">Cumulative Servicing Release for Microsoft Visual Studio 2015 Update 3 (KB3165756)</a>.</p>

<h3 id="Visual_Studio_2017">Visual Studio 2017</h3>

<p>您也可以使用 Visual Studio 2017, by <a href="https://www.visualstudio.com/downloads/">下載 community edition</a>。當安裝時，記得點勾選：</p>

<ul>
 <li>"Desktop development with C++" (最上方)</li>
 <li>"Game development with C++" (最後群組的第二項)</li>
</ul>

<p>並且確定桌面開發的工作項目欄位中的以下組件是有被勾選且將會被安裝。</p>

<ul>
 <li>VC++ 2017 v&lt;version&gt; toolset (x86,x64)</li>
 <li>Windows 10 SDK (&lt;version&gt;) for Desktop C++ x86 and x64</li>
 <li>Visual C++ ATL support</li>
</ul>

<p>安裝完後請跑一次 GUI 的介面，來確保它完成任何首次運作的任務，並將安裝與您的帳戶連結。</p>

<h3 id="需要的工具">需要的工具</h3>

<h4 id="Rust">Rust</h4>

<p>安裝 <a href="https://rustup.rs">Rust</a>。參見 <a href="https://forge.rust-lang.org/platform-support.html">Rust 平台支援</a> 頁面來找到任何您安裝上遇到的問題。</p>

<h4 id="MAPI_Header_Files_(for_Thunderbird_or_SeaMonkey_build)">MAPI Header Files (for Thunderbird or SeaMonkey build)</h4>

<p>If you are going to be building Thunderbird or SeaMonkey, check to see if <code>C:\Program Files (x86)\Windows Kits\8.1\Include\shared\MAPIX.h</code> exists. If it does not, install the <samp> </samp><a href="http://www.microsoft.com/en-us/download/details.aspx?id=12905">Outlook 2010: MAPI Header Files</a> kit. Then copy the header files in <code>C:\Office 2010 Developer Resources\Outlook 2010 MAPI Headers</code> to both:</p>

<ul>
 <li><code>C:\Program Files (x86)\Windows Kits\8.1\Include\shared</code></li>
 <li><code>C:\Program Files (x86)\Windows Kits\10\Include\10.0.</code><em>nnnnn</em><code>.0\shared</code>, where <em>nnnnn</em> is the highest number present on the system.</li>
</ul>

<h4 id="MozillaBuild">MozillaBuild</h4>

<p>最後從 Molliza 下載 <a href="https://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe">MozillaBuild 套件</a>。同意所有事項並將安裝預設目錄設為 <code>c:\mozilla-build\。</code>在一些版本的 Windows 上會出現  「重新安裝來完成安裝」，您需要點選同意並執行他的步驟。</p>

<div class="note">
<p>一旦完成，將 <code>c:\mozilla-build\start-shell.bat</code> 捷徑放到桌面上，將幫助您以後開發更加方便。</p>
</div>

<h3 class="heading-tertiary" id="與社群聯繫">與社群聯繫</h3>

<p>That last step can take some time. While it’s finishing you should take a moment to sign up for a Bugzilla account!</p>

<p><a href="https://bugzilla.mozilla.org/">Bugzilla.mozilla.org</a> is Mozilla’s issue tracker. To comment on a bug or submit a patch you’ll need a Bugzilla account; you can use your GitHub account if you have one, or <a href="https://bugzilla.mozilla.org/createaccount.cgi">sign up for a Bugzilla account directly.</a></p>

<p>As well as Bugzilla, much of Mozilla’s internal communication happens over IRC. You can <a href="http://limechat.net/mac/">download Limechat here</a>, and learn how to <a href="https://wiki.mozilla.org/IRC">connect to Mozilla with IRC here</a>. If you’re just getting started or have questions about getting set up you can join us in the #introduction channel, where some of our community members hang out to try and help new contributors get rolling.</p>

<h3 class="heading-tertiary" id="建立檔案資源">建立檔案資源</h3>

<p>這是最後一大步驟。 雙下點擊 <strong>start-shell.bat</strong> 於 <code>c:\mozilla-build</code> (或您剛剛建立的捷徑)，將會開啟終端機視窗。</p>

<p>加上這行</p>

<pre class="brush: bash"><code>PATH=$PATH:~/.cargo/bin</code></pre>

<p>在任一  <code><samp>~/.bash_profile </samp></code> <code><samp>~/.bash_login </samp></code>或  <code><samp>~/.profile</samp></code><samp>.</samp></p>

<p>在 C:\ 下建立一個資料夾叫  "mozilla-source" 並 cd 進去</p>

<pre><code>cd c:/</code>

<code>mkdir mozilla-source</code>

<code>cd mozilla-source</code></pre>

<p>接著您將用 Mercurial，我們的版本管理系統，抓取 Firefox 原始碼。輸入以下指令：</p>

<pre><code>hg clone https://hg.mozilla.org/mozilla-central</code></pre>

<p><em><code>hg</code> </em>是 mercury(汞) 的化學代號。</p>

<p>當您等待的過程中可以看一下 <a href="http://mozilla-version-control-tools.readthedocs.org/en/latest/hgmozilla/index.html">Mercurial 文件</a> 。他解釋 Mozilla 如何來做程式碼本本管理，並將改變加入源碼樹。</p>

<h3 class="heading-tertiary" id="編譯_Firefox！">編譯 Firefox！</h3>

<p>現在我們一切就緒，在您終端機輸入以下指令：</p>

<pre><code>cd mozilla-central
mach bootstrap
mach build</code></pre>

<p><code><font face="Open Sans, arial, x-locale-body, sans-serif">"</font>mach bootstrap" </code> 步驟是處理各式各樣的相依檔案，並不在此文件介紹範圍內。</p>

<p>您已經上路了，即便是在現代機器上，這也需要一點時間，別氣餒！Firefox 相當的大，因為網路世界就是如此浩瀚。</p>

<h3 class="heading-tertiary" id="加入Mozillians.org!">加入Mozillians.org!</h3>

<p>There’s one more thing you can do for yourself while you’re waiting: create an account for yourself on <a href="https://mozillians.org/">Mozillians</a>. Mozillians is the Mozilla community directory, where you can connect with people who share your interests, projects or countries. This step is optional, but we think it will be worth your while.</p>

<h3 id="一切就緒">一切就緒</h3>

<p>當 mach build 完成，代表您已經從源始碼編譯自己版本的 Firefox，您可以輸入以下指令來測試：</p>

<pre>mach run</pre>

<p class="heading-tertiary">現在你有自己版本的 Firefox 了。</p>

<p class="heading-tertiary">If you saw an error here, look further down in this document for the "Troubleshooting" section - some antiviruses quarantine some of our tests, so you need to create execeptions for the "mozilla-source" and "mozilla-build" directories. Don't turn your antivirus off! Just add the exceptions.</p>

<h3 class="heading-tertiary" id="現在是有趣的開始">現在是有趣的開始</h3>

<p>You have the code, you’ve compiled Firefox. Fire it up with <code>./mach run</code> and you’re ready to start hacking. The next steps are up to you: join us on IRC in the<em>#introduction</em> channel, follow <a href="https://twitter.com/StartMozilla">StartMozilla on Twitter</a> and find <a href="http://www.joshmatthews.net/bugsahoy/?simple=1">a bug to start working on</a>.</p>

<p>Thank you for joining us and helping us make Firefox and the open Web better for everyone.</p>

<h2 id="細節與故障排除">細節與故障排除</h2>

<h3 id="Hardware_and_software_requirements">Hardware and software requirements</h3>

<p>The Firefox build process is both I/O and CPU-intensive, and can take a long time to build even on modern hardware. Minimum and recommended hardware requirements for Mozilla development are:</p>

<ul>
 <li>At least 4 GB of RAM. 8 GB or more is recommended, and more is always better.</li>
 <li>35 GB free disk space. This amount of disk space accommodates Visual Studio 2015 Community Edition, the required SDKs, the MozillaBuild package, the Mercurial source repository and enough free disk space to compile. A solid-state hard disk is recommended; the Firefox build process is I/O-intensive.</li>
 <li>A 64-bit version of Windows 7 (Service Pack 1) or later. <span style="background-color: #f5f6f5;">You can still build 32-bit Firefox on a 64-bit Windows installation.</span></li>
</ul>

<h3 id="總攬">總攬</h3>

<p>The Mozilla build process requires many tools that are not preinstalled on most Windows  systems. In addition to Visual Studio, install MozillaBuild, a software bundle that includes the required versions of bash, GNU make, autoconf, Mercurial, and much more.</p>

<p>Firefox 48 and later build with Visual Studio 2015 in our official releases. You should be using Visual Studio 2015 to build all current versions of Firefox.</p>

<p>Firefox 37 through 47 build with Visual Studio 2013 (VC12) and possibly Visual Studio 2015 (although Visual Studio 2015 may not build every revision).</p>

<p>Earlier versions of Firefox build with older versions of Visual Studio.</p>

<h3 id="Installing_the_build_prerequisites">Installing the build prerequisites</h3>

<p>Complete each of these steps. Otherwise, you may not be able to build successfully. There are notes on these software requirements below.</p>

<ol>
 <li>Make sure your system is up-to-date through Windows Update.</li>
 <li>Install <a href="https://www.visualstudio.com/en-us/downloads/download-visual-studio-vs.aspx#d-community">Visual Studio Community 2015</a> (free). Be sure to <strong>install the "Common Tools for Visual C++ 2015", which requires a customized installation in Visual Studio 2015</strong>. Alternatively, you can also use a paid version of Visual Studio. The optional parts of the VS2015 Community install - including the Microsoft Foundation Classes for C++ - are not necessary to build Firefox. Earlier versions of Visual Studio are not supported; the Firefox codebase relies on C++ features that are not supported in VS2012 or earlier.</li>
 <li>Optionally, in addition to VS2015, you may want to also install <a href="http://go.microsoft.com/?linkid=7729279">Visual C++ 2008 Express</a> (free) to compile some Python extensions used in the build system, because Python 2.7.x on Windows is built with that compiler by default. Note, if you want to use "mach resource-usage", "mach doctor", "mach android-emulator", or run talos tests locally, you should install it for building psutil.</li>
 <li>Download and install the <a href="https://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe" title="https://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe">MozillaBuild</a> package, containing additional build tools. If you have Cygwin installed, read the note in the tips section. (After MozillaBuild's installer exits, if you see a Windows error dialog giving you the option to re-install with the 'correct settings', choose that option and after that all should be well.) More information about MozillaBuild and links to newer versions are available at <a href="https://wiki.mozilla.org/MozillaBuild" title="/en-US/docs/">https://wiki.mozilla.org/MozillaBuild</a>.</li>
</ol>

<h3 id="Troubleshooting">Troubleshooting</h3>

<p>In some circumstances, the following problems can arise:</p>

<p style="margin-left: 40px;"><strong>Some antivirus and system protection software can dramatically slow or break the build process:</strong></p>

<ul>
 <li style="margin-left: 40px;">Windows Defender and some scanning antivirus products are known to have a major impact on build times. As one example, if you have have cloned mozilla-central successfully but <code>./mach build</code> fails reporting a missing file, you are likely experiencing this problem. Our regression tests for well-known security bugs can include code samples that some antivirus software will identify as a threat, and will either quarantine or otherwise corrupt the files involved. To resolve this you will need to whitelist your source and object directories (the <code>mozilla-source</code> and <code>mozilla-build</code> directories) in Windows Defender or your antivirus software and if you're missing files, revert your source tree with the "<code>hg update -C" </code>command. Once this is done your next <code>./mach build</code> should complete successfully.</li>
</ul>

<p style="margin-left: 40px;"><strong>Installing Visual Studio in a different language than the system can cause issues</strong></p>

<ul>
 <li style="margin-left: 40px;">For example, having Visual Studio in french when the system is in english causes the build to spew a lot of include errors and finishes by a link error.</li>
</ul>

<dl>
</dl>

<p>Please note that <strong>Mozilla will not build</strong> if the path to the installation folder of some tools contains <strong>spaces</strong> or other breaking characters such as pluses, quotation marks, or metacharacters.  The Visual Studio tools and SDKs are an exception -- they may be installed in a directory which contains spaces. It is strongly recommended that you accept the default settings for all installation locations.</p>

<h3 id="MozillaBuild_2">MozillaBuild</h3>

<p>The MozillaBuild package contains other software prerequisites necessary for building Mozilla, including the MSYS build environment, <a href="/en-US/docs/Mercurial" title="Mercurial">Mercurial</a>, autoconf-2.13, CVS, Python, YASM, NSIS, and UPX, as well as optional but useful tools such as wget and emacs.</p>

<p><a href="https://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe" title="https://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe">Download the current MozillaBuild package.</a></p>

<p>By default, the package installs to <code>c:\mozilla-build</code>. It is recommended to use the default path. Don't use a path that contains spaces. The installer does not modify the Windows registry. Note that some binaries may require <a href="https://www.microsoft.com/downloads/en/details.aspx?FamilyID=a5c84275-3b97-4ab7-a40d-3802b2af5fc2&amp;displaylang=en" title="https://www.microsoft.com/downloads/en/details.aspx?FamilyID=a5c84275-3b97-4ab7-a40d-3802b2af5fc2&amp;displaylang=en">Visual C++ Redistributable package</a> to run.</p>

<p><strong>MozillaBuild command prompt expectation setting:</strong> Note that the "UNIX-like" environment provided by MozillaBuild is only really useful for building and committing to the Mozilla source. Most command line tools you would expect in a modern Linux distribution are not present, and those tools that are provided can be as much as a decade or so old (especially those provided by MSYS). It's the old tools in particular that can cause problems, since they often don't behave as expected, are buggy, or don't support command line arguments that have been taken for granted for years. For example, copying a source tree using <code>cp -rf src1 src2</code> does not work correctly because of an old version of cp (it gives "cp: will not create hard link" errors for some files). In short, MozillaBuild supports essential developer interactions with the Mozilla code, but beyond that don't be surprised if it trips you up in all sorts of exciting and unexpected ways.</p>

<h3 id="Opening_a_MozillaBuild_command_prompt">Opening a MozillaBuild command prompt</h3>

<p>After the prerequisites are installed, launch the <strong><code>start-shell.bat</code></strong> batch file using the Windows command prompt in the directory to which you installed MozillaBuild (<code>c:\mozilla-build</code> by default). This will launch an MSYS/BASH command prompt properly configured to build Firefox. All further commands should be executed in this command prompt window. (Note that this is not the same as what you get with the Windows CMD.EXE shell.)</p>

<h3 id="Create_a_directory_for_the_source">Create a directory for the source</h3>

<div class="note"><strong>Note:</strong> You won't be able to build the Firefox source code if it's under a directory with spaces in the path (e.g., don't use "Documents and Settings"). You can pick any other location, such as a new directory c:/mozilla-source or c:/thunderbird-src. The build command prompt also tolerates "c:\" and  "/c/", but the former allows confusion with the windows command prompt, and the later is misinterpreted by some tools (at least MOZ_OBJDIR). The "C:/" syntax helps draw attention that the <strong>MozillaBuild </strong>command prompt is assumed from here on out since it provides configured environment and tools.</div>

<p>It's a sensible idea to create a new shallow directory, like "c:/mozilla-source" or "c:/thunderbird-src" dedicated solely to the code:</p>

<pre>cd c:/; mkdir mozilla-source; cd mozilla-source</pre>

<p>Keeping in mind the diagnostic hints below should you have issues, you are now ready to get the Firefox source and build; continue on to <a href="/en-US/docs/Simple_Firefox_build#Get_the_source" title="Simple_Firefox_build#Get_the_source">Simple Firefox build (Get_the_source)</a>, or another like <a href="/en-US/docs/Simple_Thunderbird_build#Get_the_source" title="Simple_Firefox_build#Get_the_source">Simple Thunderbird build (Get_the_source)</a>.</p>

<h2 id="Command_Prompt_Tips_and_Caveats">Command Prompt Tips and Caveats</h2>

<ul>
 <li>To paste into this window, you must right-click on the window's title bar, move your cursor to the <strong>Edit </strong>menu, and click <strong>Paste</strong>. You can also set Quick Edit Mode in the Properties menu and right-click the window to paste your selection.</li>
 <li>If you have Cygwin installed, make sure that the MozillaBuild directories come before any Cygwin directories in the search path enhanced by <code>start-shell-msvc2015.bat</code> (use <code>echo $PATH</code> to see your search path).</li>
 <li>In the MSYS / BASH shell started by <code>start-shell-msvc2015.bat</code>, UNIX-style forward slashes (/) are used as path separators instead of the Windows-style backward slashes (\).  So if you want to change to the directory <code>c:\mydir</code>, in the MSYS shell to improve clarity, you would use <code>cd /c/mydir </code>though both <code>c:\mydir</code> and <code>c:/mydir</code> are supported.</li>
 <li>The MSYS root directory is located in <code>/c/mozilla-build/msys</code> if you used the default installation directory. It's a good idea not to build anything under this directory. Instead use something like <code>/c/mydir</code>.</li>
</ul>

<h2 id="Common_problems_hints_and_restrictions">Common problems, hints, and restrictions</h2>

<ul>
 <li><a href="/en-US/docs/Debugging_Mozilla_on_Windows_FAQ" title="Debugging_Mozilla_on_Windows_FAQ">Debugging Mozilla on Windows FAQ</a>: Tips on how to debug Mozilla on Windows.</li>
 <li>If you have both Visual Studio 2015 and 2017 installed, the build system will default to using 2017. This can be overridden by adding the line below to your mozconfig file:
  <pre lang="en"><span id="the-code">ac_add_options --with-visual-studio-version=2015</span></pre>
 </li>
 <li>The build may fail if your machine is configured with the wrong architecture. If you want to build 64-bit Firefox, add the two lines below to your mozconfig file:
  <pre lang="en"><span id="the-code">ac_add_options --target=x86_64-pc-mingw32
ac_add_options --host=x86_64-pc-mingw3</span><span>2</span></pre>
 </li>
 <li>The build may fail if your <code>PATH</code> environment variable contains quotes ("). Quotes are not properly translated when passed down to MozillaBuild sub-shells. Quotes are usually not needed so they can be removed.</li>
 <li>The build may fail if you have a <code>PYTHON</code> environment variable set. It displays an error almost immediately that says "<code>The system cannot find the file specified</code>." In a command shell, typing "<code>unset PYTHON</code>" before running the Mozilla build tools in that same shell should fix this. Make sure that <code>PYTHON</code> is unset, rather than set to an empty value.</li>
 <li>The build may fail if you have Cygwin installed. Make sure that the MozillaBuild directories (<code>/c/mozilla-build</code> and subdirectories) come before any Cygwin directories in your PATH environment variable. If this does not help, remove the Cygwin directories from PATH, or try building on a clean PC with no Cygwin.</li>
 <li>Building with versions of NSIS other than the version that comes with the latest supported version of MozillaBuild is not supported and will likely fail.</li>
 <li>If you intend to distribute your build to others, set <code>WIN32_REDIST_DIR=$VCINSTALLDIR\redist\x86\Microsoft.VC80.CRT</code> in your mozconfig to get the Microsoft CRT DLLs packaged along with the application.</li>
 <li>The <a href="https://www.microsoft.com/security/malwareremove/default.aspx" title="https://www.microsoft.com/security/malwareremove/default.aspx">Microsoft Antimalware service</a> can interfere with compilation, often manifesting as an error related to <code>conftest.exe</code> during build. To remedy this, add at least your object directory to the <a href="http://social.answers.microsoft.com/Forums/en-US/msescan/thread/0867c974-cf19-460d-a75d-e35f283d4ad3" title="http://social.answers.microsoft.com/Forums/en-US/msescan/thread/0867c974-cf19-460d-a75d-e35f283d4ad3">exclusion settings</a>.</li>
 <li>If you encounter an error like "second C linkage of overloaded function '_interlockedbittestandset' not allowed", it happens when intrin.h and windows.h are included together. Use a #define to redefine one instance of the function's name. See more on <a href="/en-US/docs/Developer_Guide/Build_Instructions/Intrin.h" title="https://developer.mozilla.org/En/Developer_Guide/Build_Instructions/Intrin.h">using intrin.h</a>.</li>
 <li>Parallel builds (<code>-jN</code>) do not work with GNU make on Windows. You should use the <code>mozmake</code> command included with current versions of MozillaBuild. Building with the <code>mach</code> command will always use the best available make command.</li>
</ul>

<p><em><a href="/en-US/docs/Developer_Guide/Build_Instructions" title="Build_Documentation">Return to the Build Documentation </a></em></p>